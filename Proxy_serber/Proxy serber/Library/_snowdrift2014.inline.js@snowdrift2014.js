$(function(){function t(){var t=home.localStorage.getItem("animation_snowdrift2014_running");"0"===t&&(R=!1,b.addClass("animation__controls_play"))}function a(){home.localStorage.setItem("animation_snowdrift2014_running",R?"1":"0")}function n(t){y&&csh_ifgsid(y+"."+t)}function o(){for(var t=0,o=Y.length;o>t;t++)Y[t]=parseInt(Y[t],10);window.device&&b.show(),b.click(function(){R=!R,R?(b.removeClass("animation__controls_play"),O=0,h(1),m(),n("start")):(b.addClass("animation__controls_play"),c(),g(),n("stop")),a()}),M.mouseenter(function(t){A=[Math.floor(t.pageX),Math.floor(t.pageY)],X=!0,T||(requestAnimationFrame(h),T=!0)}).mouseleave(function(){X=!1}).mousemove(function(t){A=[Math.floor(t.pageX),Math.floor(t.pageY)]}),window.addEventListener&&window.addEventListener("devicemotion",function(t){e(t)},!0)}function e(t){if(R&&!((new Date).getTime()<z+G)){var a=90===Math.abs(window.orientation)?t.accelerationIncludingGravity.y:-t.accelerationIncludingGravity.x;(-90===window.orientation||180===window.orientation)&&(a=-a),Math.abs(a-Z)>j/2&&(clearTimeout(_),a>0&&Math.abs(a)>j?(A=[p.left+5,0],X=!0):0>a&&Math.abs(a)>j?(A=[p.left+p.width-5,0],X=!0):X&&(_=setTimeout(function(){X=!1},B)),T||(requestAnimationFrame(h),T=!0),Z=a),z=(new Date).getTime()}}function i(){for(var t=4,a=Y.length;a-4>t;t++)t%2===0&&(Y[t]+=F);for(t=0,a=Y.length;a>t;t++)Y[t]=Math.round(Y[t]);P=.2*(Y[4]+Y[14]-p.width),I[0].setAttribute("d","M"+Y[0]+","+Y[1]+"L"+Y[2]+","+Y[3]+"M"+Y[4]+","+Y[5]+"C"+Y[6]+","+Y[7]+","+(Y[8]+P)+","+(Y[9]-k)+","+(Y[10]+P)+","+(Y[11]-k)+"S"+Y[12]+","+Y[13]+","+Y[14]+","+Y[15]+"M"+Y[16]+","+Y[17]+"L"+Y[18]+","+Y[19]+"Z")}function r(){x.css("opacity",D/100)}function l(){return A[0]-p.left}function h(t){if(R){if(0!==O){var a,n=t-O;if(X){k+=n/30,k=Math.min(k,q[1]),a=Y[10]+P;var o=window.device?n/12:n/8;F=l()<a?-o:o;var e=l()+F;(Math.abs(l()-a)<2*o||e>L[1]||e<L[0])&&(F=0),D+=n/8,D=Math.min(D,E[1])}else k-=n/40,k=Math.max(k,q[0]),F=0,D-=n/8,D=Math.max(D,E[0]);if(Math.floor(k)===Math.floor(q[1])){var c=-1,d=null;for(var f in V)V.hasOwnProperty(f)&&Math.abs(a-V[f].logo-V[f].width/2)<Q&&t-N>U&&(c=V[f].logo,d=f,N=t,c!==K&&s(d),K=c)}(Math.floor(H)!==Math.floor(k)||F)&&(i(),H=k),Math.floor(J)!==Math.floor(D)&&(r(),J=D)}O=t,requestAnimationFrame(h)}}function c(){H=k=q[0],i(),J=D=E[0],r()}function s(t){t===W?($(".animation__gifts",M).remove(),W="",f()):W||Math.random()<V[t].chance&&(d(t),n("change."+t))}function d(t){if(t?home.localStorage.setItem("animation_snowdrift2014",t):t=home.localStorage.getItem("animation_snowdrift2014"),t){var a='<div class="animation__gifts animation__gift_'+t+'"></div>';$(M).append(a),W=t}}function f(){home.localStorage.setItem("animation_snowdrift2014","")}function m(){if(R){ea.save(),ea.globalAlpha=.9,ea.rect(0,0,oa.width,oa.height),ta=ea.createPattern(oa,"no-repeat"),ea.clearRect(0,0,oa.width,oa.height),X&&(ea.fillStyle=ta,ea.fill()),ea.restore();for(var t=0;ra>t;t++){var a=na[t];a.velX*=.98,a.velY<=a.speed&&(a.velY=a.speed);var n=0,o=0;if(X){var e=Y[10]+P;o=.005*Math.abs(10+l()-e),n=.004*(l()-e),n+=.05*Math.sin(Math.cos(8*a.x-t)-9*a.y)}else n+=.1*Math.sin(Math.cos(7*a.x+t)-6*a.y);a.velY+=o,a.velX+=n,a.y+=a.velY,a.x+=a.velX*(1+2*Math.cos(Math.sin(a.x)+a.velY/20)),a.y>=85&&u(a),(a.x>=oa.width*(1+la)||a.x<=-oa.width*la)&&u(a),ea.beginPath(),ea.drawImage(aa,0,-ia[a.type],18,18,a.x,a.y,12,12),ea.fill()}requestAnimationFrame(m)}}function g(){ea.clearRect(0,0,oa.width,oa.height)}function u(t,a){t.x=-la*oa.width+Math.floor(Math.random()*(1+la)*oa.width),t.y=a?Math.floor(90*Math.random()-80):X?80*Math.random():80*Math.random()-70,t.y-=5,t.size=2*Math.random()+1,t.velX=0,t.opacity=.45*Math.random()+.6,t.type=Math.floor(Math.random()*ia.length),t.speed=.2*(2+.2*t.type+.2*Math.random()),t.velY=t.speed}function w(){for(var t=null,a=0;ra>a;a++)t={},u(t,!0),na.push(t);m()}function v(){aa=new Image,aa.onload=function(){w()},aa.src=$(".animation__snowflakes",M).css("backgroundImage").replace(/^url|"|'|\(|\)/g,"")}if(window.requestAnimationFrame&&document.createElement("canvas").getContext){var M=$(".animation__snowdrift2014");if(M.length){$(".b-logo__image_bg").after(M),M.removeClass("i-hidden");var _,p=M[0].getBoundingClientRect(),y=M.data("stat"),b=$(".animation__controls",M),x=$(".animation__paranja",M),I=$(".animation__snowdrift_1 path",M),C=I.attr("d"),S=C.replace(/L|C|S|M|Z/g," "),Y=S.replace(/\s+/g," ").replace(/^\s/,"").replace(/\s$/,"").split(" "),A=null,X=!1,k=0,q=[0,41],F=0,L=[0,180],T=!1,D=0,E=[0,50],P=0,R=!0,z=(new Date).getTime(),G=.01,Z=0,j=1.2,B=500,O=0,H=0,J=0,K=0,N=0,Q=2,U=300,V={bear:{logo:39,width:36,chance:.4},mammoth:{logo:69,width:52,chance:.4},izbushka:{logo:36,width:40,chance:.55},bullfinch:{logo:92,width:36,chance:.4},snowman:{logo:67,width:36,chance:.45},valenok:{logo:121,width:31,chance:.5},moose:{logo:-8,width:91,chance:.3},penguin:{logo:135,width:36,chance:.3}},W="";d(),o(),t();var ta,aa,na=[],oa=$(".animation__snow",M)[0],ea=oa.getContext("2d"),ia=[0,-28,-56,-102,-125,-145,-163,-180],ra=100,la=.8;v()}}});